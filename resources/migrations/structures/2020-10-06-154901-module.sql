CREATE TABLE module (id VARCHAR(32) NOT NULL, name VARCHAR(255) NOT NULL, description VARCHAR(255) DEFAULT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET UTF8 COLLATE `UTF8_unicode_ci` ENGINE = InnoDB;
ALTER TABLE page ADD CONSTRAINT FK_140AB620C242628 FOREIGN KEY (module) REFERENCES module (id) ON DELETE CASCADE;
DROP INDEX uri_params_idx ON route;
CREATE UNIQUE INDEX package_uri_params_idx ON route (package_id, uri, params);
ALTER TABLE images ADD page_id INT DEFAULT NULL, ADD package_id INT DEFAULT NULL;
ALTER TABLE images ADD CONSTRAINT FK_E01FBE6AC4663E4 FOREIGN KEY (page_id) REFERENCES page (id) ON DELETE CASCADE;
ALTER TABLE images ADD CONSTRAINT FK_E01FBE6AF44CABFF FOREIGN KEY (package_id) REFERENCES package (id) ON DELETE CASCADE;
CREATE INDEX IDX_E01FBE6AC4663E4 ON images (page_id);
CREATE INDEX IDX_E01FBE6AF44CABFF ON images (package_id);
ALTER TABLE package ADD base TINYINT(1) DEFAULT NULL, CHANGE module module VARCHAR(32) DEFAULT NULL;
ALTER TABLE package ADD CONSTRAINT FK_DE686795C242628 FOREIGN KEY (module) REFERENCES module (id) ON DELETE CASCADE;
CREATE UNIQUE INDEX base_package_idx ON package (base, module);
